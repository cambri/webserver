

<VirtualHost *:{{ config.port.http|default(80) }}>
    ServerAdmin webmaster@{% if hostname %}{{ hostname.hostname }}{% else %}{{ hostnames.first.hostname }}{% endif %}

    {% if hostname %}
    ServerName {{ hostname.hostname }}
    {% else %}
        {% for hostname in hostnames.lists('hostname') %}
            {% if loop.index == 0 %}
    ServerName {{ hostname }}
            {% else %}
    ServerAlias {{ hostname }}
            {% endif %}
        {% endfor %}
    {% endif %}

    # public path, serving content
    DocumentRoot {{ public_path }}
    # default document handling
    DirectoryIndex index.html index.php

    # user
#    RUidGid {{ website.identifier }} users

    {% if website.directory.media %}
    # media directory
    alias "/media/" "{{ website.directory.media }}"
    {% endif %}

    # allow cross domain loading of resources
    Header set Access-Control-Allow-Origin "*"

    # logging
    ErrorLog {{ log_path ~ '.error.log' }}
    CustomLog {{ log_path ~ '.access.log' }} combined
</VirtualHost>


{% if ssl %}
<VirtualHost *:{{ config.port.https|default(443) }}>
    ServerAdmin webmaster@{% if hostname %}{{ hostname.hostname }}{% else %}{{ hostnames.first.hostname }}{% endif %}


    {% if hostname %}
    ServerName {{ hostname.hostname }}
    {% else %}
        {% for hostname in hostnames.lists('hostname') %}
            {% if loop.index == 0 %}
    ServerName {{ hostname }}
            {% else %}
    ServerAlias {{ hostname }}
            {% endif %}
        {% endfor %}
    {% endif %}

    # public path, serving content
    DocumentRoot {{ public_path }}
    # default document handling
    DirectoryIndex index.html index.php

    # user
#    RUidGid {{ website.identifier }} users

    {% if website.directory.media %}
    # media directory
    alias "/media/" "{{ website.directory.media }}"
    {% endif %}

    # allow cross domain loading of resources
    Header set Access-Control-Allow-Origin "*"

    # logging
    ErrorLog {{ log_path ~ '.error.log' }}
    CustomLog {{ log_path ~ '.access.log' }} combined

    # enable SSL
    SSLEngine On
    SSLCertificateFile {{ ssl.pathPem }}
    SSLCertificateKeyFile {{ ssl.pathKey }}

    <FilesMatch "\.(cgi|shtml|phtml|php)$">
    SSLOptions +StdEnvVars
    </FilesMatch>
    BrowserMatch "MSIE [2-6]" \
    nokeepalive ssl-unclean-shutdown \
    downgrade-1.0 force-response-1.0
    # MSIE 7 and newer should be able to use keepalive
    BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown
</VirtualHost>
{% endif %}